<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP Pasteler√≠a Completo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { margin: 0; font-family: -apple-system, sans-serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .6; } }
        @media print { .no-print { display: none; } }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const CONFIG = {
            get GOOGLE_SHEETS_ID() { return localStorage.getItem('sheets_id') || ''; },
            set GOOGLE_SHEETS_ID(v) { localStorage.setItem('sheets_id', v); },
            get GOOGLE_API_KEY() { return localStorage.getItem('api_key') || ''; },
            set GOOGLE_API_KEY(v) { localStorage.setItem('api_key', v); },
        };

        const ERP = () => {
            const [module, setModule] = useState('dashboard');
            const [syncing, setSyncing] = useState(false);
            const [lastSync, setLastSync] = useState(null);
            
            const [ventas, setVentas] = useState([]);
            const [gastos, setGastos] = useState([]);
            const [personal, setPersonal] = useState([]);
            const [inventario, setInventario] = useState([]);
            const [clientes, setClientes] = useState([]);
            const [productos, setProductos] = useState([]);
            const [proveedores, setProveedores] = useState([]);
            const [servicios, setServicios] = useState([]);
            const [kds, setKds] = useState([]);
            const [delivery, setDelivery] = useState([]);

            const syncSheets = async () => {
                setSyncing(true);
                try {
                    if (!CONFIG.GOOGLE_SHEETS_ID || !CONFIG.GOOGLE_API_KEY) {
                        alert('‚ö†Ô∏è Configura primero:\n\n1. Google Sheets ID\n2. Google API Key\n\nVe a ‚öôÔ∏è Config');
                        setModule('config');
                        setSyncing(false);
                        return;
                    }

                    const base = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.GOOGLE_SHEETS_ID}/values`;
                    const key = `?key=${CONFIG.GOOGLE_API_KEY}`;
                    let cargados = {};

                    // VENTAS (A hasta R = 18 columnas)
                    try {
                        const r = await fetch(`${base}/VENTAS!A2:R${key}`);
                        if (r.ok) {
                            const d = await r.json();
                            if (d.values) {
                                setVentas(d.values.map((r, i) => ({
                                    id: i+1, numero: r[0]||'', fechaEmision: r[1]||'', fechaEntrega: r[2]||'',
                                    horaEntrega: r[3]||'', nPedido: r[4]||'', vendedor: r[5]||'', cliente: r[6]||'',
                                    docIdentidad: r[7]||'', telefono: r[8]||'', moneda: r[9]||'PEN', monto: parseFloat(r[10])||0,
                                    contacto: r[11]||'', nContacto: r[12]||'', saldo: parseFloat(r[13])||0, direccion: r[14]||'',
                                    distrito: r[15]||'', observaciones: r[16]||'', estado: r[17]||'Pendiente'
                                })));
                                cargados.ventas = d.values.length;
                            }
                        }
                    } catch(e) { console.warn('VENTAS:', e); }

                    // GASTOS (A hasta K = 11 columnas seg√∫n tu estructura)
                    try {
                        const r = await fetch(`${base}/GASTOS!A2:K${key}`);
                        if (r.ok) {
                            const d = await r.json();
                            if (d.values) {
                                setGastos(d.values.map((r, i) => ({
                                    id: i+1,
                                    periodo: r[0]||'',
                                    area: r[1]||'',
                                    razonSocial: r[2]||'',
                                    tipoDoc: r[3]||'',
                                    serie: r[4]||'',
                                    numero: r[5]||'',
                                    descripcion: r[6]||'',
                                    monto: parseFloat(r[7])||0,
                                    pendiente: parseFloat(r[8])||0,
                                    medio: r[9]||'',
                                    observaciones: r[10]||''
                                })));
                                cargados.gastos = d.values.length;
                            }
                        }
                    } catch(e) { console.warn('GASTOS:', e); }

                    // PERSONAL (A hasta K)
                    try {
                        const r = await fetch(`${base}/PERSONAL!A2:K${key}`);
                        if (r.ok) {
                            const d = await r.json();
                            if (d.values) {
                                setPersonal(d.values.map((r, i) => ({
                                    id: i+1, nombre: r[0]||'', cargo: r[1]||'', sueldoBase: parseFloat(r[2])||0,
                                    afp: parseFloat(r[3])||0, renta5ta: parseFloat(r[4])||0, 
                                    planilla: r[6]==='SI', rrxhh: r[7]==='SI', ultimoPago: r[8]||'',
                                    tipoPago: r[9]||'MENSUAL', estado: r[10]||'PENDIENTE'
                                })));
                                cargados.personal = d.values.length;
                            }
                        }
                    } catch(e) { console.warn('PERSONAL:', e); }

                    // INVENTARIO (A hasta I)
                    try {
                        const r = await fetch(`${base}/INVENTARIO!A2:I${key}`);
                        if (r.ok) {
                            const d = await r.json();
                            if (d.values) {
                                setInventario(d.values.map((r, i) => ({
                                    id: i+1, codigo: r[0]||'', nombre: r[1]||'', stock: parseFloat(r[2])||0,
                                    unidad: r[3]||'', costo: parseFloat(r[4])||0, valorTotal: parseFloat(r[5])||0,
                                    stockMin: parseFloat(r[6])||0, proveedor: r[7]||''
                                })));
                                cargados.inventario = d.values.length;
                            }
                        }
                    } catch(e) { console.warn('INVENTARIO:', e); }

                    // PRODUCTOS (A hasta J)
                    try {
                        const r = await fetch(`${base}/PRODUCTOS!A2:J${key}`);
                        if (r.ok) {
                            const d = await r.json();
                            if (d.values) {
                                setProductos(d.values.map((r, i) => ({
                                    id: i+1, codigo: r[0]||'', nombre: r[1]||'', precio: parseFloat(r[2])||0,
                                    categoria: r[3]||'', insumo1: r[4]||'', cant1: parseFloat(r[5])||0,
                                    insumo2: r[6]||'', cant2: parseFloat(r[7])||0, insumo3: r[8]||'', cant3: parseFloat(r[9])||0
                                })));
                                cargados.productos = d.values.length;
                            }
                        }
                    } catch(e) { console.warn('PRODUCTOS:', e); }

                    // CLIENTES (A hasta I)
                    try {
                        const r = await fetch(`${base}/CLIENTES!A2:I${key}`);
                        if (r.ok) {
                            const d = await r.json();
                            if (d.values) {
                                setClientes(d.values.map((r, i) => ({
                                    id: i+1, rucDni: r[0]||'', razonSocial: r[1]||'', telefono: r[2]||'',
                                    distrito: r[3]||'', totalCompras: parseFloat(r[4])||0, cantCompras: parseInt(r[5])||0,
                                    ultimaCompra: r[6]||'', tipo: r[7]||'PERSONA', estado: r[8]||'ACTIVO'
                                })));
                                cargados.clientes = d.values.length;
                            }
                        }
                    } catch(e) { console.warn('CLIENTES:', e); }

                    // PROVEEDORES (A hasta G)
                    try {
                        const r = await fetch(`${base}/PROVEEDORES!A2:G${key}`);
                        if (r.ok) {
                            const d = await r.json();
                            if (d.values) {
                                setProveedores(d.values.map((r, i) => ({
                                    id: i+1, ruc: r[0]||'', razonSocial: r[1]||'', telefono: r[2]||'',
                                    categoria: r[3]||'', totalComprado: parseFloat(r[4])||0, cantCompras: parseInt(r[5])||0,
                                    ultimaCompra: r[6]||''
                                })));
                                cargados.proveedores = d.values.length;
                            }
                        }
                    } catch(e) { console.warn('PROVEEDORES:', e); }

                    // SERVICIOS (A hasta H)
                    try {
                        const r = await fetch(`${base}/SERVICIOS!A2:H${key}`);
                        if (r.ok) {
                            const d = await r.json();
                            if (d.values) {
                                setServicios(d.values.map((r, i) => ({
                                    id: i+1, servicio: r[0]||'', monto: parseFloat(r[1])||0, vencimiento: r[2]||'',
                                    pagado: parseFloat(r[3])||0, pendiente: parseFloat(r[4])||0,
                                    medioPago: r[5]||'', estado: r[6]||'PENDIENTE'
                                })));
                                cargados.servicios = d.values.length;
                            }
                        }
                    } catch(e) { console.warn('SERVICIOS:', e); }

                    // KDS (A hasta H)
                    try {
                        const r = await fetch(`${base}/KDS!A2:H${key}`);
                        if (r.ok) {
                            const d = await r.json();
                            if (d.values) {
                                setKds(d.values.map((r, i) => ({
                                    id: i+1, hora: r[0]||'', nPedido: r[1]||'', cliente: r[2]||'',
                                    productos: r[3]||'', cantidad: parseInt(r[4])||0, prioridad: r[5]||'MEDIA',
                                    estado: r[6]||'PENDIENTE', horaEntrega: r[7]||''
                                })));
                                cargados.kds = d.values.length;
                            }
                        }
                    } catch(e) { console.warn('KDS:', e); }

                    // DELIVERY (A hasta J)
                    try {
                        const r = await fetch(`${base}/DELIVERY!A2:J${key}`);
                        if (r.ok) {
                            const d = await r.json();
                            if (d.values) {
                                setDelivery(d.values.map((r, i) => ({
                                    id: i+1, fecha: r[0]||'', nPedido: r[1]||'', delivery: r[2]||'',
                                    tipo: r[3]||'', destino: r[4]||'', costo: parseFloat(r[5])||0,
                                    cobradoCliente: parseFloat(r[6])||0, horaSalida: r[7]||'', horaEntrega: r[8]||''
                                })));
                                cargados.delivery = d.values.length;
                            }
                        }
                    } catch(e) { console.warn('DELIVERY:', e); }

                    setLastSync(new Date());
                    const msg = Object.entries(cargados).map(([k,v]) => `${k}: ${v}`).join('\n');
                    alert(`‚úÖ Sincronizaci√≥n exitosa!\n\nüìä Registros cargados:\n${msg || 'Sin datos'}`);
                } catch (error) {
                    alert(`‚ùå Error:\n\n${error.message}\n\nVerifica:\n- Sheet ID\n- API Key\n- Google Sheets API habilitada`);
                }
                setSyncing(false);
            };

            const calc = useMemo(() => {
                const ingresos = ventas.reduce((s, v) => s + v.monto, 0);
                const gastosTotal = gastos.reduce((s, g) => s + g.monto, 0);
                
                const vendedoras = Object.entries(ventas.reduce((acc, v) => {
                    if (!acc[v.vendedor]) acc[v.vendedor] = {cant: 0, monto: 0};
                    acc[v.vendedor].cant++;
                    acc[v.vendedor].monto += v.monto;
                    return acc;
                }, {})).sort((a,b) => b[1].monto - a[1].monto);

                const distritos = Object.entries(ventas.reduce((acc, v) => {
                    if (!acc[v.distrito]) acc[v.distrito] = {cant: 0, monto: 0};
                    acc[v.distrito].cant++;
                    acc[v.distrito].monto += v.monto;
                    return acc;
                }, {})).sort((a,b) => b[1].monto - a[1].monto);

                const categorias = Object.entries(gastos.reduce((acc, g) => {
                    if (!acc[g.area]) acc[g.area] = 0;
                    acc[g.area] += g.monto;
                    return acc;
                }, {})).sort((a,b) => b[1] - a[1]);

                const mediosPago = Object.entries(gastos.reduce((acc, g) => {
                    if (!acc[g.medio]) acc[g.medio] = 0;
                    acc[g.medio] += g.monto;
                    return acc;
                }, {})).sort((a,b) => b[1] - a[1]);

                return {ingresos, gastosTotal, balance: ingresos - gastosTotal, vendedoras, distritos, categorias, mediosPago, ticket: ventas.length ? ingresos/ventas.length : 0};
            }, [ventas, gastos]);

            const Dashboard = () => (
                <div className="space-y-6">
                    <div className="bg-blue-600 rounded-xl p-4 text-white flex justify-between items-center">
                        <div>
                            <p className="font-bold text-lg">üìä Dashboard Principal</p>
                            {lastSync && <p className="text-sm opacity-90">√öltima sync: {lastSync.toLocaleTimeString()}</p>}
                        </div>
                        <button onClick={syncSheets} disabled={syncing} className="bg-white text-blue-600 px-6 py-2 rounded-lg font-bold hover:bg-blue-50">
                            {syncing ? <span className="pulse">üîÑ</span> : 'üîÑ Sincronizar'}
                        </button>
                    </div>

                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div className="bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl p-6 text-white">
                            <p className="text-3xl">üí∞</p>
                            <h3 className="text-2xl font-bold">S/ {calc.ingresos.toLocaleString('es-PE', {minimumFractionDigits:2})}</h3>
                            <p className="text-sm opacity-90">Ingresos</p>
                        </div>
                        <div className="bg-gradient-to-br from-red-500 to-rose-600 rounded-xl p-6 text-white">
                            <p className="text-3xl">üí∏</p>
                            <h3 className="text-2xl font-bold">S/ {calc.gastosTotal.toLocaleString('es-PE', {minimumFractionDigits:2})}</h3>
                            <p className="text-sm opacity-90">Gastos</p>
                        </div>
                        <div className="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl p-6 text-white">
                            <p className="text-3xl">üìä</p>
                            <h3 className="text-2xl font-bold">S/ {calc.balance.toLocaleString('es-PE', {minimumFractionDigits:2})}</h3>
                            <p className="text-sm opacity-90">Balance</p>
                        </div>
                        <div className="bg-gradient-to-br from-purple-500 to-violet-600 rounded-xl p-6 text-white">
                            <p className="text-3xl">üì¶</p>
                            <h3 className="text-2xl font-bold">{ventas.length}</h3>
                            <p className="text-sm opacity-90">Pedidos</p>
                        </div>
                    </div>

                    <div className="grid md:grid-cols-2 gap-6">
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h3 className="text-xl font-bold mb-4">üèÜ Ranking Vendedoras</h3>
                            {calc.vendedoras.length === 0 ? <p className="text-gray-500">Sin datos</p> : (
                                <div className="space-y-2">
                                    {calc.vendedoras.slice(0,5).map(([nombre, data], i) => (
                                        <div key={i} className="flex justify-between p-3 bg-gray-50 rounded-lg">
                                            <div className="flex gap-3 items-center">
                                                <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold ${i===0?'bg-yellow-400':i===1?'bg-gray-300':'bg-orange-300'}`}>{i+1}</div>
                                                <div>
                                                    <p className="font-bold">{nombre}</p>
                                                    <p className="text-sm text-gray-600">{data.cant} ventas</p>
                                                </div>
                                            </div>
                                            <p className="text-xl font-bold text-green-600">S/ {data.monto.toLocaleString()}</p>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>

                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h3 className="text-xl font-bold mb-4">üìç Ranking Distritos</h3>
                            {calc.distritos.length === 0 ? <p className="text-gray-500">Sin datos</p> : (
                                <div className="space-y-2">
                                    {calc.distritos.slice(0,5).map(([dist, data], i) => (
                                        <div key={i} className="flex justify-between p-3 bg-gray-50 rounded-lg">
                                            <div>
                                                <p className="font-bold">{dist || 'SIN DISTRITO'}</p>
                                                <p className="text-sm text-gray-600">{data.cant} ventas</p>
                                            </div>
                                            <p className="text-xl font-bold text-blue-600">S/ {data.monto.toLocaleString()}</p>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="bg-white rounded-xl shadow-lg p-6">
                        <h3 className="text-xl font-bold mb-4">üí∞ Gastos por Categor√≠a</h3>
                        {calc.categorias.length === 0 ? <p className="text-gray-500">Sin datos</p> : (
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                {calc.categorias.map(([cat, monto]) => (
                                    <div key={cat} className="p-4 bg-red-50 rounded-lg border-2 border-red-200">
                                        <p className="text-sm font-bold text-gray-700">{cat}</p>
                                        <p className="text-xl font-bold text-red-600">S/ {monto.toLocaleString()}</p>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );

            const ReporteIngresos = () => (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h2 className="text-2xl font-bold mb-6">üí∞ Reporte de Ingresos</h2>
                    {ventas.length === 0 ? <p className="text-gray-500 text-center py-8">No hay ventas registradas</p> : (
                        <>
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm">
                                    <thead>
                                        <tr className="bg-gray-100">
                                            <th className="p-2 text-left">Fecha</th>
                                            <th className="p-2 text-left">Pedido</th>
                                            <th className="p-2 text-left">Cliente</th>
                                            <th className="p-2 text-left">Vendedor</th>
                                            <th className="p-2 text-left">Distrito</th>
                                            <th className="p-2 text-right">Monto</th>
                                            <th className="p-2 text-center">Estado</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {ventas.map(v => (
                                            <tr key={v.id} className="border-b hover:bg-gray-50">
                                                <td className="p-2">{v.fechaEmision}</td>
                                                <td className="p-2 font-bold">{v.nPedido}</td>
                                                <td className="p-2">{v.cliente}</td>
                                                <td className="p-2">{v.vendedor}</td>
                                                <td className="p-2">{v.distrito}</td>
                                                <td className="p-2 text-right font-bold text-green-600">S/ {v.monto.toFixed(2)}</td>
                                                <td className="p-2 text-center"><span className={`px-2 py-1 rounded-full text-xs font-bold ${v.estado==='ENTREGADO'?'bg-green-100 text-green-700':'bg-yellow-100 text-yellow-700'}`}>{v.estado}</span></td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                            <div className="mt-6 p-4 bg-green-50 rounded-lg">
                                <p className="text-2xl font-bold text-green-700">Total: S/ {calc.ingresos.toFixed(2)}</p>
                                <p className="text-gray-600">Ticket Promedio: S/ {calc.ticket.toFixed(2)}</p>
                            </div>
                        </>
                    )}
                </div>
            );

            const ReporteGastos = () => (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h2 className="text-2xl font-bold mb-6">üí∏ Reporte de Gastos</h2>
                    {gastos.length === 0 ? <p className="text-gray-500 text-center py-8">No hay gastos registrados</p> : (
                        <>
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm">
                                    <thead>
                                        <tr className="bg-gray-100">
                                            <th className="p-2 text-left">Periodo</th>
                                            <th className="p-2 text-left">Categor√≠a</th>
                                            <th className="p-2 text-left">Proveedor</th>
                                            <th className="p-2 text-left">Descripci√≥n</th>
                                            <th className="p-2 text-right">Monto</th>
                                            <th className="p-2 text-left">Medio</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {gastos.map(g => (
                                            <tr key={g.id} className="border-b hover:bg-gray-50">
                                                <td className="p-2">{g.periodo}</td>
                                                <td className="p-2"><span className="px-2 py-1 bg-purple-100 rounded text-xs">{g.area}</span></td>
                                                <td className="p-2">{g.razonSocial}</td>
                                                <td className="p-2">{g.descripcion}</td>
                                                <td className="p-2 text-right font-bold text-red-600">S/ {g.monto.toFixed(2)}</td>
                                                <td className="p-2">{g.medio}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                            <div className="mt-6 grid md:grid-cols-2 gap-4">
                                <div className="p-4 bg-red-50 rounded-lg">
                                    <p className="text-xl font-bold text-red-700">Total Gastos: S/ {calc.gastosTotal.toFixed(2)}</p>
                                </div>
                                <div className="p-4 bg-blue-50 rounded-lg">
                                    <p className="text-sm font-bold text-gray-700 mb-2">Por Medio de Pago:</p>
                                    {calc.mediosPago.map(([medio, monto]) => (
                                        <p key={medio} className="text-sm">{medio}: S/ {monto.toFixed(2)}</p>
                                    ))}
                                </div>
                            </div>
                        </>
                    )}
                </div>
            );

            const ReportePersonal = () => (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h2 className="text-2xl font-bold mb-6">üë• Personal y Planilla</h2>
                    {personal.length === 0 ? <p className="text-gray-500 text-center py-8">No hay personal registrado</p> : (
                        <>
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm">
                                    <thead>
                                        <tr className="bg-gray-100">
                                            <th className="p-2 text-left">Nombre</th>
                                            <th className="p-2 text-left">Cargo</th>
                                            <th className="p-2 text-right">Sueldo</th>
                                            <th className="p-2 text-right">AFP</th>
                                            <th className="p-2 text-right">Renta 5ta</th>
                                            <th className="p-2 text-right">Total</th>
                                            <th className="p-2 text-center">Planilla</th>
                                            <th className="p-2 text-center">Tipo</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {personal.map(p => (
                                            <tr key={p.id} className="border-b hover:bg-gray-50">
                                                <td className="p-2 font-bold">{p.nombre}</td>
                                                <td className="p-2">{p.cargo}</td>
                                                <td className="p-2 text-right">S/ {p.sueldoBase.toFixed(2)}</td>
                                                <td className="p-2 text-right text-red-600">-S/ {p.afp.toFixed(2)}</td>
                                                <td className="p-2 text-right text-red-600">-S/ {p.renta5ta.toFixed(2)}</td>
                                                <td className="p-2 text-right font-bold text-green-600">S/ {(p.sueldoBase-p.afp-p.renta5ta).toFixed(2)}</td>
                                                <td className="p-2 text-center"><span className={`px-2 py-1 rounded text-xs ${p.planilla?'bg-blue-100 text-blue-700':'bg-gray-100'}`}>{p.planilla?'PLANILLA':'RRXHH'}</span></td>
                                                <td className="p-2 text-center text-xs">{p.tipoPago}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                            <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                                <p className="text-xl font-bold text-blue-700">Total Planilla: S/ {personal.reduce((s,p) => s + (p.sueldoBase-p.afp-p.renta5ta), 0).toFixed(2)}</p>
                            </div>
                        </>
                    )}
                </div>
            );

            const ReporteClientes = () => (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h2 className="text-2xl font-bold mb-6">üë§ Base de Clientes</h2>
                    {clientes.length === 0 ? <p className="text-gray-500 text-center py-8">No hay clientes registrados</p> : (
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm">
                                <thead>
                                    <tr className="bg-gray-100">
                                        <th className="p-2 text-left">RUC/DNI</th>
                                        <th className="p-2 text-left">Cliente</th>
                                        <th className="p-2 text-left">Tel√©fono</th>
                                        <th className="p-2 text-left">Distrito</th>
                                        <th className="p-2 text-right">Total Compras</th>
                                        <th className="p-2 text-center">Cantidad</th>
                                        <th className="p-2 text-center">Tipo</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {clientes.sort((a,b) => b.totalCompras - a.totalCompras).map(c => (
                                        <tr key={c.id} className="border-b hover:bg-gray-50">
                                            <td className="p-2 font-mono text-xs">{c.rucDni}</td>
                                            <td className="p-2 font-bold">{c.razonSocial}</td>
                                            <td className="p-2">{c.telefono}</td>
                                            <td className="p-2">{c.distrito}</td>
                                            <td className="p-2 text-right font-bold text-green-600">S/ {c.totalCompras.toLocaleString()}</td>
                                            <td className="p-2 text-center">{c.cantCompras}</td>
                                            <td className="p-2 text-center"><span className={`px-2 py-1 rounded text-xs ${c.tipo==='EMPRESA'?'bg-purple-100 text-purple-700':'bg-blue-100 text-blue-700'}`}>{c.tipo}</span></td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}
                </div>
            );

            const ReporteInventario = () => (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h2 className="text-2xl font-bold mb-6">üì¶ Inventario</h2>
                    {inventario.length === 0 ? <p className="text-gray-500 text-center py-8">No hay inventario registrado</p> : (
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm">
                                <thead>
                                    <tr className="bg-gray-100">
                                        <th className="p-2 text-left">C√≥digo</th>
                                        <th className="p-2 text-left">Insumo</th>
                                        <th className="p-2 text-right">Stock</th>
                                        <th className="p-2 text-center">Unidad</th>
                                        <th className="p-2 text-right">Costo</th>
                                        <th className="p-2 text-right">Valor Total</th>
                                        <th className="p-2 text-center">Estado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {inventario.map(i => (
                                        <tr key={i.id} className="border-b hover:bg-gray-50">
                                            <td className="p-2 font-mono text-xs">{i.codigo}</td>
                                            <td className="p-2 font-bold">{i.nombre}</td>
                                            <td className="p-2 text-right">{i.stock}</td>
                                            <td className="p-2 text-center">{i.unidad}</td>
                                            <td className="p-2 text-right">S/ {i.costo.toFixed(2)}</td>
                                            <td className="p-2 text-right font-bold">S/ {(i.stock * i.costo).toFixed(2)}</td>
                                            <td className="p-2 text-center">
                                                <span className={`px-2 py-1 rounded text-xs font-bold ${i.stock<i.stockMin?'bg-red-100 text-red-700':i.stock<i.stockMin*1.5?'bg-yellow-100 text-yellow-700':'bg-green-100 text-green-700'}`}>
                                                    {i.stock<i.stockMin?'‚ö†Ô∏è CR√çTICO':i.stock<i.stockMin*1.5?'‚ö° ALERTA':'‚úÖ OK'}
                                                </span>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}
                </div>
            );

            const ReporteProductos = () => (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h2 className="text-2xl font-bold mb-6">üç∞ Productos y Recetas</h2>
                    {productos.length === 0 ? <p className="text-gray-500 text-center py-8">No hay productos registrados</p> : (
                        <div className="grid md:grid-cols-2 gap-4">
                            {productos.map(p => (
                                <div key={p.id} className="border-2 rounded-lg p-4 hover:shadow-lg">
                                    <div className="flex justify-between items-start mb-2">
                                        <div>
                                            <p className="font-bold text-lg">{p.nombre}</p>
                                            <p className="text-sm text-gray-600">{p.codigo}</p>
                                        </div>
                                        <p className="text-2xl font-bold text-green-600">S/ {p.precio.toFixed(2)}</p>
                                    </div>
                                    <p className="text-xs text-gray-500 mb-2">Categor√≠a: {p.categoria}</p>
                                    <div className="bg-gray-50 p-2 rounded">
                                        <p className="text-xs font-bold mb-1">Receta:</p>
                                        {p.insumo1 && <p className="text-xs">‚Ä¢ {p.insumo1}: {p.cant1}</p>}
                                        {p.insumo2 && <p className="text-xs">‚Ä¢ {p.insumo2}: {p.cant2}</p>}
                                        {p.insumo3 && <p className="text-xs">‚Ä¢ {p.insumo3}: {p.cant3}</p>}
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );

            const ReporteProveedores = () => (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h2 className="text-2xl font-bold mb-6">üè≠ Proveedores</h2>
                    {proveedores.length === 0 ? <p className="text-gray-500 text-center py-8">No hay proveedores registrados</p> : (
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm">
                                <thead>
                                    <tr className="bg-gray-100">
                                        <th className="p-2 text-left">RUC</th>
                                        <th className="p-2 text-left">Raz√≥n Social</th>
                                        <th className="p-2 text-left">Tel√©fono</th>
                                        <th className="p-2 text-left">Categor√≠a</th>
                                        <th className="p-2 text-right">Total Comprado</th>
                                        <th className="p-2 text-center">Cant. Compras</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {proveedores.sort((a,b) => b.totalComprado - a.totalComprado).map(p => (
                                        <tr key={p.id} className="border-b hover:bg-gray-50">
                                            <td className="p-2 font-mono text-xs">{p.ruc}</td>
                                            <td className="p-2 font-bold">{p.razonSocial}</td>
                                            <td className="p-2">{p.telefono}</td>
                                            <td className="p-2">{p.categoria}</td>
                                            <td className="p-2 text-right font-bold text-orange-600">S/ {p.totalComprado.toLocaleString()}</td>
                                            <td className="p-2 text-center">{p.cantCompras}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}
                </div>
            );

            const ReporteServicios = () => (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h2 className="text-2xl font-bold mb-6">‚ö° Servicios y Pagos</h2>
                    {servicios.length === 0 ? <p className="text-gray-500 text-center py-8">No hay servicios registrados</p> : (
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm">
                                <thead>
                                    <tr className="bg-gray-100">
                                        <th className="p-2 text-left">Servicio</th>
                                        <th className="p-2 text-right">Monto</th>
                                        <th className="p-2 text-left">Vencimiento</th>
                                        <th className="p-2 text-right">Pagado</th>
                                        <th className="p-2 text-right">Pendiente</th>
                                        <th className="p-2 text-center">Estado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {servicios.map(s => (
                                        <tr key={s.id} className="border-b hover:bg-gray-50">
                                            <td className="p-2 font-bold">{s.servicio}</td>
                                            <td className="p-2 text-right">S/ {s.monto.toFixed(2)}</td>
                                            <td className="p-2">{s.vencimiento}</td>
                                            <td className="p-2 text-right text-green-600">S/ {s.pagado.toFixed(2)}</td>
                                            <td className="p-2 text-right text-red-600">S/ {s.pendiente.toFixed(2)}</td>
                                            <td className="p-2 text-center"><span className={`px-2 py-1 rounded text-xs ${s.estado==='PAGADO'?'bg-green-100 text-green-700':'bg-red-100 text-red-700'}`}>{s.estado}</span></td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}
                </div>
            );

            const ReporteKDS = () => (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h2 className="text-2xl font-bold mb-6">üë®‚Äçüç≥ KDS - Kitchen Display</h2>
                    {kds.length === 0 ? <p className="text-gray-500 text-center py-8">No hay pedidos en KDS</p> : (
                        <div className="grid md:grid-cols-2 gap-4">
                            {kds.map(k => (
                                <div key={k.id} className={`border-2 rounded-lg p-4 ${k.prioridad==='ALTA'?'border-red-400 bg-red-50':k.prioridad==='MEDIA'?'border-yellow-400 bg-yellow-50':'border-green-400 bg-green-50'}`}>
                                    <div className="flex justify-between items-start mb-2">
                                        <div>
                                            <p className="font-bold text-lg">{k.nPedido}</p>
                                            <p className="text-sm">{k.cliente}</p>
                                        </div>
                                        <span className={`px-3 py-1 rounded font-bold text-xs ${k.prioridad==='ALTA'?'bg-red-600 text-white':k.prioridad==='MEDIA'?'bg-yellow-600 text-white':'bg-green-600 text-white'}`}>{k.prioridad}</span>
                                    </div>
                                    <p className="text-sm mb-2"><strong>{k.productos}</strong> x {k.cantidad}</p>
                                    <div className="flex justify-between text-xs text-gray-600">
                                        <span>Recibido: {k.hora}</span>
                                        <span>Entregar: {k.horaEntrega}</span>
                                    </div>
                                    <div className="mt-2">
                                        <span className={`px-2 py-1 rounded text-xs font-bold ${k.estado==='EN PROCESO'?'bg-blue-100 text-blue-700':k.estado==='LISTO'?'bg-green-100 text-green-700':'bg-gray-100'}`}>{k.estado}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );

            const ReporteDelivery = () => (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h2 className="text-2xl font-bold mb-6">üöó Delivery</h2>
                    {delivery.length === 0 ? <p className="text-gray-500 text-center py-8">No hay entregas registradas</p> : (
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm">
                                <thead>
                                    <tr className="bg-gray-100">
                                        <th className="p-2 text-left">Fecha</th>
                                        <th className="p-2 text-left">Pedido</th>
                                        <th className="p-2 text-left">Delivery</th>
                                        <th className="p-2 text-left">Tipo</th>
                                        <th className="p-2 text-left">Destino</th>
                                        <th className="p-2 text-right">Costo</th>
                                        <th className="p-2 text-right">Cobrado</th>
                                        <th className="p-2 text-right">Ganancia</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {delivery.map(d => (
                                        <tr key={d.id} className="border-b hover:bg-gray-50">
                                            <td className="p-2">{d.fecha}</td>
                                            <td className="p-2 font-bold">{d.nPedido}</td>
                                            <td className="p-2">{d.delivery}</td>
                                            <td className="p-2"><span className={`px-2 py-1 rounded text-xs ${d.tipo==='PROPIO'?'bg-green-100 text-green-700':'bg-blue-100 text-blue-700'}`}>{d.tipo}</span></td>
                                            <td className="p-2">{d.destino}</td>
                                            <td className="p-2 text-right text-red-600">S/ {d.costo.toFixed(2)}</td>
                                            <td className="p-2 text-right text-green-600">S/ {d.cobradoCliente.toFixed(2)}</td>
                                            <td className="p-2 text-right font-bold">{d.cobradoCliente - d.costo >= 0 ? <span className="text-green-600">S/ {(d.cobradoCliente - d.costo).toFixed(2)}</span> : <span className="text-red-600">-S/ {(d.costo - d.cobradoCliente).toFixed(2)}</span>}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}
                </div>
            );

            const Config = () => {
                const [id, setId] = useState(CONFIG.GOOGLE_SHEETS_ID);
                const [key, setKey] = useState(CONFIG.GOOGLE_API_KEY);

                return (
                    <div className="bg-white rounded-xl p-6 max-w-2xl">
                        <h2 className="text-2xl font-bold mb-4">‚öôÔ∏è Configuraci√≥n</h2>
                        <div className="space-y-4">
                            <div>
                                <label className="block font-bold mb-2">Google Sheets ID</label>
                                <input value={id} onChange={e => setId(e.target.value)} className="w-full p-3 border-2 rounded-lg font-mono text-sm" placeholder="1oUu...Xws" />
                                <p className="text-xs text-gray-600 mt-1">De la URL: docs.google.com/spreadsheets/d/<strong>ESTE_ID</strong>/edit</p>
                            </div>
                            <div>
                                <label className="block font-bold mb-2">Google API Key</label>
                                <input value={key} onChange={e => setKey(e.target.value)} className="w-full p-3 border-2 rounded-lg font-mono text-sm" placeholder="AIza..." />
                                <p className="text-xs text-gray-600 mt-1">Crear en: console.cloud.google.com/apis/credentials</p>
                            </div>
                            <button onClick={() => { CONFIG.GOOGLE_SHEETS_ID = id; CONFIG.GOOGLE_API_KEY = key; alert('‚úÖ Guardado! Recarga (F5)'); }} className="w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-bold text-lg hover:bg-blue-700">
                                üíæ Guardar Configuraci√≥n
                            </button>
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
                    <div className="bg-gradient-to-r from-slate-900 to-blue-900 text-white p-4 sticky top-0 z-50 shadow-xl">
                        <h1 className="text-xl md:text-2xl font-bold">üéÇ ERP PASTELER√çA PROFESIONAL COMPLETO</h1>
                        <p className="text-xs md:text-sm text-blue-200">Sistema Integrado de Gesti√≥n Empresarial</p>
                    </div>

                    <div className="bg-white border-b p-2 sticky top-16 z-40 shadow-md overflow-x-auto scrollbar-hide">
                        <div className="flex gap-2 text-xs">
                            {[
                                {id:'dashboard', name:'üìä Dashboard'},
                                {id:'ingresos', name:'üí∞ Ingresos'},
                                {id:'gastos', name:'üí∏ Gastos'},
                                {id:'personal', name:'üë• Personal'},
                                {id:'clientes', name:'üë§ Clientes'},
                                {id:'inventario', name:'üì¶ Inventario'},
                                {id:'productos', name:'üç∞ Productos'},
                                {id:'proveedores', name:'üè≠ Proveedores'},
                                {id:'servicios', name:'‚ö° Servicios'},
                                {id:'kds', name:'üë®‚Äçüç≥ KDS'},
                                {id:'delivery', name:'üöó Delivery'},
                                {id:'config', name:'‚öôÔ∏è Config'},
                            ].map(m => (
                                <button key={m.id} onClick={() => setModule(m.id)} className={`px-3 py-2 rounded-lg font-bold whitespace-nowrap ${module===m.id?'bg-blue-600 text-white shadow-lg':'bg-gray-100 hover:bg-gray-200'}`}>
                                    {m.name}
                                </button>
                            ))}
                        </div>
                    </div>

                    <div className="p-4">
                        {module==='dashboard' && <Dashboard />}
                        {module==='ingresos' && <ReporteIngresos />}
                        {module==='gastos' && <ReporteGastos />}
                        {module==='personal' && <ReportePersonal />}
                        {module==='clientes' && <ReporteClientes />}
                        {module==='inventario' && <ReporteInventario />}
                        {module==='productos' && <ReporteProductos />}
                        {module==='proveedores' && <ReporteProveedores />}
                        {module==='servicios' && <ReporteServicios />}
                        {module==='kds' && <ReporteKDS />}
                        {module==='delivery' && <ReporteDelivery />}
                        {module==='config' && <Config />}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<ERP />, document.getElementById('root'));
    </script>
</body>
</html>
