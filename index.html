<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>BRAVIZIMO‚ÄôS ERP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --bg:#020617;
      --bg-elevated:#020617;
      --accent:#4f46e5;
      --accent-soft:rgba(79,70,229,.25);
      --border:#1e293b;
      --text:#e2e8f0;
      --muted:#64748b;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:"Inter",system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      background:#020617;
      color:var(--text);
      display:flex;
      min-height:100vh;
    }
    .sidebar{
      width:260px;
      background:#020617;
      border-right:1px solid var(--border);
      padding:1.25rem 1rem;
      display:flex;
      flex-direction:column;
      gap:1rem;
      position:sticky;
      top:0;
      height:100vh;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:.7rem;
      padding:.25rem .5rem;
    }
    .brand-logo{
      width:34px;height:34px;border-radius:999px;
      background:radial-gradient(circle at 30% 30%,#f97316 0,#ea580c 35%,#4b1d0f 100%);
      display:flex;align-items:center;justify-content:center;
      font-weight:800;font-size:1rem;color:#020617;
    }
    .brand-text span:first-child{
      font-weight:700;letter-spacing:.08em;text-transform:uppercase;font-size:.78rem;
    }
    .brand-text span:last-child{
      font-size:.7rem;color:var(--muted);
    }
    .nav-section-title{
      font-size:.7rem;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:var(--muted);
      margin-top:.5rem;
      margin-bottom:.25rem;
      padding:0 .4rem;
    }
    .nav-item{
      display:flex;
      align-items:center;
      gap:.5rem;
      padding:.4rem .55rem;
      border-radius:.6rem;
      font-size:.83rem;
      color:var(--muted);
      cursor:pointer;
      transition:background .12s,color .12s,transform .08s;
    }
    .nav-item:hover{
      background:#020617;
      color:var(--text);
      transform:translateX(1px);
    }
    .nav-item.active{
      background:var(--accent-soft);
      color:var(--text);
      border:1px solid rgba(79,70,229,.7);
    }
    .nav-item i{width:18px;text-align:center;}
    .sidebar-footer{
      margin-top:auto;
      font-size:.7rem;
      color:var(--muted);
      padding:0 .5rem;
    }

    .main{
      flex:1;
      padding:1.25rem 1.5rem;
      max-width:1320px;
      margin:0 auto;
      display:flex;
      flex-direction:column;
      gap:.9rem;
    }
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
    }
    .topbar-title h1{
      margin:0;
      font-size:1.25rem;
      letter-spacing:.04em;
    }
    .topbar-title p{
      margin:.2rem 0 0;
      font-size:.78rem;
      color:var(--muted);
    }
    .topbar-actions{
      display:flex;
      gap:.5rem;
      align-items:center;
    }
    .btn{
      border-radius:999px;
      border:1px solid var(--border);
      background:#020617;
      color:var(--text);
      padding:.42rem .85rem;
      font-size:.78rem;
      display:inline-flex;
      align-items:center;
      gap:.3rem;
      cursor:pointer;
    }
    .btn-primary{
      background:linear-gradient(135deg,#4f46e5,#6366f1);
      border-color:transparent;
      color:#fff;
      box-shadow:0 0 0 1px rgba(129,140,248,.4),0 16px 40px rgba(15,23,42,.9);
    }
    .btn-primary:hover{filter:brightness(1.07);}

    .page-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:1rem;
      margin-top:.3rem;
      margin-bottom:.35rem;
    }
    .page-header h1{
      margin:0;
      font-size:1.05rem;
    }
    .page-header p{
      margin:.15rem 0 0;
      font-size:.78rem;
      color:var(--muted);
    }

    .stats-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(190px,1fr));
      gap:.85rem;
    }
    .card{
      background:#020617;
      border-radius:1rem;
      border:1px solid var(--border);
      padding:.9rem 1rem;
      box-shadow:0 18px 50px rgba(15,23,42,.95);
    }
    .card h3{
      margin:0 0 .5rem;
      font-size:.9rem;
    }
    .card small{
      font-size:.75rem;
      color:var(--muted);
    }

    .stat-value{
      font-size:1.2rem;
      font-weight:600;
    }
    .stat-sub{
      font-size:.75rem;
      color:var(--muted);
    }

    table{
      width:100%;
      border-collapse:collapse;
      font-size:.78rem;
    }
    th,td{
      padding:.4rem .5rem;
      border-bottom:1px solid #020617;
      text-align:left;
    }
    th{
      font-size:.7rem;
      color:var(--muted);
      background:#020617;
      letter-spacing:.06em;
      text-transform:uppercase;
      position:sticky;
      top:0;
      z-index:1;
    }
    tbody tr:hover{background:rgba(15,23,42,.85);}

    .badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:.12rem .45rem;
      border-radius:999px;
      font-size:.65rem;
      border:1px solid #4b5563;
    }
    .badge.green{
      border-color:rgba(22,163,74,.7);
      color:#4ade80;
      background:rgba(22,163,74,.16);
    }
    .badge.red{
      border-color:rgba(248,113,113,.8);
      color:#fecaca;
      background:rgba(248,113,113,.14);
    }
    .badge.amber{
      border-color:rgba(245,158,11,.7);
      color:#facc15;
      background:rgba(245,158,11,.14);
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      padding:.16rem .55rem;
      border-radius:999px;
      border:1px solid var(--border);
      font-size:.7rem;
      color:var(--muted);
    }

    .loader{
      padding:2rem 0;
      text-align:center;
      font-size:.8rem;
      color:var(--muted);
    }

    .toast{
      position:fixed;
      bottom:1.5rem;
      right:1.5rem;
      display:none;
      align-items:center;
      gap:.5rem;
      background:#020617;
      border-radius:999px;
      border:1px solid var(--border);
      padding:.45rem .8rem;
      font-size:.78rem;
      box-shadow:0 18px 55px rgba(15,23,42,.95);
      z-index:999;
    }
    .toast.success{border-color:rgba(34,197,94,.5);}
    .toast.error{border-color:rgba(248,113,113,.7);}
    .toast.warn{border-color:rgba(234,179,8,.8);}

    @media (max-width:900px){
      .sidebar{display:none;}
      body{display:block;}
      .main{padding:1rem;}
    }
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="brand">
      <div class="brand-logo">BR</div>
      <div class="brand-text">
        <span>BRAVIZIMO‚ÄôS</span>
        <span>ERP ¬∑ Bocaditos</span>
      </div>
    </div>

    <div>
      <div class="nav-section-title">General</div>
      <div class="nav-item active" data-page="dashboard" onclick="navigateTo('dashboard',this)">
        <i class="fas fa-chart-line"></i><span>Dashboard</span>
      </div>

      <div class="nav-section-title">Ventas & Entregas</div>
      <div class="nav-item" data-page="ventas" onclick="navigateTo('ventas',this)">
        <i class="fas fa-receipt"></i><span>Ventas</span>
      </div>
      <div class="nav-item" data-page="cotizaciones" onclick="navigateTo('cotizaciones',this)">
        <i class="fas fa-file-invoice-dollar"></i><span>Cotizaciones</span>
      </div>
      <div class="nav-item" data-page="delivery" onclick="navigateTo('delivery',this)">
        <i class="fas fa-motorcycle"></i><span>Delivery</span>
      </div>

      <div class="nav-section-title">Operaci√≥n</div>
      <div class="nav-item" data-page="inventario" onclick="navigateTo('inventario',this)">
        <i class="fas fa-boxes-stacked"></i><span>Inventario</span>
      </div>
      <div class="nav-item" data-page="insumos" onclick="navigateTo('insumos',this)">
        <i class="fas fa-bowl-rice"></i><span>Insumos</span>
      </div>
      <div class="nav-item" data-page="produccion" onclick="navigateTo('produccion',this)">
        <i class="fas fa-industry"></i><span>Producci√≥n</span>
      </div>
      <div class="nav-item" data-page="compras" onclick="navigateTo('compras',this)">
        <i class="fas fa-cart-shopping"></i><span>Compras</span>
      </div>
      <div class="nav-item" data-page="proveedores" onclick="navigateTo('proveedores',this)">
        <i class="fas fa-truck-field"></i><span>Proveedores</span>
      </div>

      <div class="nav-section-title">Finanzas</div>
      <div class="nav-item" data-page="gastos" onclick="navigateTo('gastos',this)">
        <i class="fas fa-coins"></i><span>Gastos</span>
      </div>
      <div class="nav-item" data-page="servicios" onclick="navigateTo('servicios',this)">
        <i class="fas fa-bolt"></i><span>Servicios</span>
      </div>
      <div class="nav-item" data-page="facturas" onclick="navigateTo('facturas',this)">
        <i class="fas fa-file-invoice"></i><span>Facturas</span>
      </div>
      <div class="nav-item" data-page="kpi_vendedoras" onclick="navigateTo('kpi_vendedoras',this)">
        <i class="fas fa-ranking-star"></i><span>KPI vendedoras</span>
      </div>
      <div class="nav-item" data-page="ksd" onclick="navigateTo('ksd',this)">
        <i class="fas fa-chart-column"></i><span>KSD diario</span>
      </div>

      <div class="nav-section-title">Personas & Servicio</div>
      <div class="nav-item" data-page="clientes" onclick="navigateTo('clientes',this)">
        <i class="fas fa-user-group"></i><span>Clientes</span>
      </div>
      <div class="nav-item" data-page="personal" onclick="navigateTo('personal',this)">
        <i class="fas fa-users"></i><span>RRHH / Personal</span>
      </div>
      <div class="nav-item" data-page="reclamos" onclick="navigateTo('reclamos',this)">
        <i class="fas fa-triangle-exclamation"></i><span>Reclamos</span>
      </div>
    </div>

    <div class="sidebar-footer">
      <div>BRAVIZIMO‚ÄôS ERP v2</div>
      <div style="margin-top:.1rem;">Conectado a Google Sheets</div>
    </div>
  </aside>

  <main class="main">
    <header class="topbar">
      <div class="topbar-title">
        <h1>Panel de control</h1>
        <p>Resumen de ventas, operaci√≥n, finanzas y equipo</p>
      </div>
      <div class="topbar-actions">
        <button class="btn" onclick="syncData()">
          <i class="fas fa-arrows-rotate"></i> Sincronizar
        </button>
      </div>
    </header>

    <div id="app"></div>
  </main>

  <div id="toast" class="toast"><span id="toast-icon">üîî</span><span id="toast-text">Mensaje</span></div>

  <script src="https://kit.fontawesome.com/a2e0e6ad1b.js" crossorigin="anonymous"></script>
  <script>
    // üîó URL de tu Web App de Apps Script (ACTUALIZADA)
    const API_URL = 'https://script.google.com/macros/s/AKfycbwTYVWclKwS3x5WZB_Le4inuDN-sVLswLhW7B6_Rh9oLZl7qzK-6IxT_cDvL1dNQDUL/exec';

    let DATA = null;
    let DASHBOARD = null;
    let currentPage = 'dashboard';
    let kpiChart = null;
    let gastosChart = null;

    function showToast(msg, type='info'){
      const t = document.getElementById('toast');
      const icon = document.getElementById('toast-icon');
      const text = document.getElementById('toast-text');
      t.className = 'toast';
      if(type==='success') t.classList.add('success');
      if(type==='error') t.classList.add('error');
      if(type==='warn') t.classList.add('warn');
      text.textContent = msg;
      icon.textContent = type==='success'?'‚úÖ':type==='error'?'‚ùå':'‚ö†Ô∏è';
      t.style.display = 'flex';
      setTimeout(()=>{t.style.display='none';},3000);
    }

    function showLoader(msg){
      document.getElementById('app').innerHTML =
        '<div class="loader"><i class="fas fa-circle-notch fa-spin"></i> '+msg+'</div>';
    }

    async function fetchJSON(url){
      const res = await fetch(url);
      if(!res.ok) throw new Error('HTTP '+res.status);
      return res.json();
    }

    async function init(){
      try{
        showLoader('Cargando datos del ERP...');
        const [dash, all] = await Promise.all([
          fetchJSON(API_URL + '?action=dashboard'),
          fetchJSON(API_URL + '?action=getAll')
        ]);
        DASHBOARD = dash;
        DATA = all;
        render();
      }catch(e){
        console.error(e);
        showLoader('Error al conectar con el ERP. Revisa que el Web App tenga acceso "Cualquiera" y URL correcta.');
      }
    }

    async function syncData(){
      try{
        showLoader('Sincronizando con Google Sheets...');
        await fetchJSON(API_URL + '?action=sync');
        const [dash, all] = await Promise.all([
          fetchJSON(API_URL + '?action=dashboard'),
          fetchJSON(API_URL + '?action=getAll')
        ]);
        DASHBOARD = dash;
        DATA = all;
        render();
        showToast('Sincronizaci√≥n completa.', 'success');
      }catch(e){
        console.error(e);
        showToast('Error al sincronizar.', 'error');
      }
    }

    function navigateTo(page, el){
      currentPage = page;
      document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
      if(el) el.classList.add('active');
      render();
    }

    function money(v){
      const n = parseFloat(v || 0);
      return 'S/ ' + n.toFixed(2);
    }

    function badge(text){
      if(!text) return '';
      const t = String(text).toLowerCase();
      let cls = 'amber';
      if(['pagado','completado','activo','emitida','entregado','resuelto'].includes(t)) cls='green';
      if(['anulado','cancelado','vencido'].includes(t)) cls='red';
      return '<span class="badge '+cls+'">'+text+'</span>';
    }

    function render(){
      if(!DATA || !DASHBOARD){
        showLoader('Cargando datos...');
        return;
      }
      let html = '';
      switch(currentPage){
        case 'dashboard':       html = renderDashboard();       break;
        case 'ventas':          html = renderVentas();          break;
        case 'cotizaciones':    html = renderCotizaciones();    break;
        case 'inventario':      html = renderInventario();      break;
        case 'insumos':         html = renderInsumos();         break;
        case 'produccion':      html = renderProduccion();      break;
        case 'compras':         html = renderCompras();         break;
        case 'proveedores':     html = renderProveedores();     break;
        case 'gastos':          html = renderGastos();          break;
        case 'servicios':       html = renderServicios();       break;
        case 'facturas':        html = renderFacturas();        break;
        case 'delivery':        html = renderDelivery();        break;
        case 'clientes':        html = renderClientes();        break;
        case 'personal':        html = renderPersonal();        break;
        case 'reclamos':        html = renderReclamos();        break;
        case 'kpi_vendedoras':  html = renderKpiVendedoras();   break;
        case 'ksd':             html = renderKsd();             break;
        default:                html = renderDashboard();
      }
      document.getElementById('app').innerHTML = html;

      if(currentPage === 'kpi_vendedoras') initKpiChart();
      if(currentPage === 'gastos') initGastosChart();
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderDashboard(){
      const est = DATA.estadisticas || {};
      const a = DASHBOARD.alertas || [];
      const alertsHtml = a.map(x=>`<div class="pill">${x.tipo==='error'?'üî¥':'üü°'} ${x.mensaje}</div>`).join('') ||
        '<span class="stat-sub">Sin alertas de inventario ni servicios.</span>';

      return `
        <div class="page-header">
          <div>
            <h1>Resumen general</h1>
            <p>Ventas, pedidos, clientes y alertas clave</p>
          </div>
          <div>
            <span class="pill">
              <i class="fas fa-database"></i> Datos: ${DATA.timestamp ? DATA.timestamp.substring(0,10) : ''}
            </span>
          </div>
        </div>

        <div class="stats-grid">
          <div class="card">
            <h3>Ventas hoy</h3>
            <div class="stat-value">${money(DASHBOARD.ventasHoy.total || 0)}</div>
            <div class="stat-sub">${DASHBOARD.ventasHoy.cantidad || 0} pedidos</div>
          </div>
          <div class="card">
            <h3>Ventas del mes</h3>
            <div class="stat-value">${money(DASHBOARD.ventasMes.total || 0)}</div>
            <div class="stat-sub">${DASHBOARD.ventasMes.cantidad || 0} pedidos</div>
          </div>
          <div class="card">
            <h3>Ticket promedio</h3>
            <div class="stat-value">${money(est.ticketPromedio || 0)}</div>
            <div class="stat-sub">${est.cantidadVentas || 0} ventas hist√≥ricas</div>
          </div>
          <div class="card">
            <h3>Clientes & Productos</h3>
            <div class="stat-value">${est.totalClientes || 0} <span style="font-size:.8rem;font-weight:400;color:var(--muted);">clientes</span></div>
            <div class="stat-sub">${est.totalProductos || 0} productos activos</div>
          </div>
        </div>

        <div class="stats-grid" style="margin-top:.9rem;">
          <div class="card">
            <h3>Pedidos pendientes</h3>
            <p class="stat-sub" style="margin-bottom:.5rem;">Pedidos con estado Pendiente o Confirmado</p>
            <div class="stat-value">${DASHBOARD.pedidosPendientes || 0}</div>
          </div>
          <div class="card">
            <h3>Alertas</h3>
            <div style="display:flex;flex-wrap:wrap;gap:.35rem;margin-top:.45rem;">
              ${alertsHtml}
            </div>
          </div>
        </div>
      `;
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ VENTAS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderVentas(){
      const v = DATA.ventas || [];
      const rows = v.slice(0,120).map(r=>`
        <tr>
          <td>${r.idventa||''}</td>
          <td>${r.fecharegistro||''}</td>
          <td>${r.fechaentrega||''}</td>
          <td>${r.canal||''}</td>
          <td>${r.cliente||''}</td>
          <td>${r.vendedora||''}</td>
          <td>${money(r.total||0)}</td>
          <td>${badge(r.estadopago)}</td>
          <td>${badge(r.estadopedido)}</td>
        </tr>
      `).join('') || '<tr><td colspan="9" style="text-align:center;color:var(--muted);padding:.8rem;">Sin ventas registradas.</td></tr>';

      return `
        <div class="page-header">
          <div>
            <h1>Ventas</h1>
            <p>Historial de ventas por canal y estado</p>
          </div>
        </div>
        <div class="card">
          <h3>Listado de ventas</h3>
          <div style="max-height:460px;overflow:auto;margin-top:.4rem;border-radius:.7rem;border:1px solid #020617;">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>F. Registro</th>
                  <th>F. Entrega</th>
                  <th>Canal</th>
                  <th>Cliente</th>
                  <th>Vendedora</th>
                  <th>Total</th>
                  <th>Pago</th>
                  <th>Pedido</th>
                </tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
          </div>
        </div>
      `;
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ COTIZACIONES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderCotizaciones(){
      const c = DATA.cotizaciones || [];
      const rows = c.slice(0,80).map(r=>`
        <tr>
          <td>${r.id||''}</td>
          <td>${r.fecha||''}</td>
          <td>${r.cliente||''}</td>
          <td>${r.vendedora||''}</td>
          <td>${money(r.total||0)}</td>
          <td>${badge(r.estado)}</td>
        </tr>
      `).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--muted);padding:.8rem;">Sin cotizaciones.</td></tr>';
      return `
        <div class="page-header">
          <div>
            <h1>Cotizaciones</h1>
            <p>Propuestas a clientes (pendientes y aceptadas)</p>
          </div>
        </div>
        <div class="card">
          <h3>Listado de cotizaciones</h3>
          <div style="max-height:440px;overflow:auto;margin-top:.4rem;border-radius:.7rem;border:1px solid #020617;">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Fecha</th>
                  <th>Cliente</th>
                  <th>Vendedora</th>
                  <th>Total</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
          </div>
        </div>
      `;
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ INVENTARIO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderInventario(){
      const inv = DATA.inventario || [];
      const rows = inv.slice(0,160).map(p=>{
        const stock = parseFloat(p.stockactual||0);
        const min = parseFloat(p.stockminimo||0);
        let estado = 'OK', cls='green';
        if(stock<=0){estado='Sin stock';cls='red';}
        else if(stock<=min){estado='Por agotarse';cls='amber';}
        return `
          <tr>
            <td>${p.codigo||''}</td>
            <td>${p.nombreproducto||''}</td>
            <td>${p.categoria||''}</td>
            <td>${stock}</td>
            <td>${min}</td>
            <td>${money(p.precioventa||0)}</td>
            <td>${money(p.costo||0)}</td>
            <td><span class="badge ${cls}">${estado}</span></td>
          </tr>
        `;
      }).join('') || '<tr><td colspan="8" style="text-align:center;color:var(--muted);padding:.8rem;">Sin productos en inventario.</td></tr>';

      return `
        <div class="page-header">
          <div>
            <h1>Inventario</h1>
            <p>Stock de productos terminados</p>
          </div>
        </div>
        <div class="card">
          <h3>Productos</h3>
          <div style="max-height:460px;overflow:auto;margin-top:.4rem;border-radius:.7rem;border:1px solid #020617;">
            <table>
              <thead>
                <tr>
                  <th>C√≥digo</th>
                  <th>Producto</th>
                  <th>Categor√≠a</th>
                  <th>Stock</th>
                  <th>M√≠nimo</th>
                  <th>Precio</th>
                  <th>Costo</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
          </div>
        </div>
      `;
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ INSUMOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderInsumos(){
      const ins = DATA.insumos || [];
      const rows = ins.slice(0,160).map(i=>{
        const stock = parseFloat(i.stock||0);
        const min   = parseFloat(i.minimo||0);
        let estado='OK',cls='green';
        if(stock<=0){estado='Sin stock';cls='red';}
        else if(stock<=min){estado='Por agotarse';cls='amber';}
        return `
          <tr>
            <td>${i.codigo||''}</td>
            <td>${i.nombre||''}</td>
            <td>${i.categoria||''}</td>
            <td>${stock}</td>
            <td>${min}</td>
            <td>${money(i.costounit||0)}</td>
            <td>${i.proveedor||''}</td>
            <td><span class="badge ${cls}">${estado}</span></td>
          </tr>
        `;
      }).join('') || '<tr><td colspan="8" style="text-align:center;color:var(--muted);padding:.8rem;">Sin insumos registrados.</td></tr>';

      return `
        <div class="page-header">
          <div>
            <h1>Insumos</h1>
            <p>Harinas, az√∫car, mantequilla, envases y m√°s</p>
          </div>
        </div>
        <div class="card">
          <h3>Lista de insumos</h3>
          <div style="max-height:460px;overflow:auto;margin-top:.4rem;border-radius:.7rem;border:1px solid #020617;">
            <table>
              <thead>
                <tr>
                  <th>C√≥digo</th>
                  <th>Nombre</th>
                  <th>Categor√≠a</th>
                  <th>Stock</th>
                  <th>M√≠nimo</th>
                  <th>Costo Unit</th>
                  <th>Proveedor</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
          </div>
        </div>
      `;
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ PRODUCCI√ìN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderProduccion(){
      const p = DATA.produccion || [];
      const rows = p.slice(0,120).map(r=>`
        <tr>
          <td>${r.id||''}</td>
          <td>${r.fecha||''}</td>
          <td>${r.producto||''}</td>
          <td>${r.cantidad||''}</td>
          <td>${money(r.costo||0)}</td>
          <td>${badge(r.estado)}</td>
        </tr>
      `).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--muted);padding:.8rem;">Sin √≥rdenes de producci√≥n.</td></tr>';

      return `
        <div class="page-header">
          <div>
            <h1>Producci√≥n</h1>
            <p>Lotes producidos de bocaditos y tortas</p>
          </div>
        </div>
        <div class="card">
          <h3>√ìrdenes de producci√≥n</h3>
          <div style="max-height:460px;overflow:auto;margin-top:.4rem;border-radius:.7rem;border:1px solid #020617;">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Fecha</th>
                  <th>Producto</th>
                  <th>Cantidad</th>
                  <th>Costo</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
          </div>
        </div>
      `;
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ COMPRAS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderCompras(){
      const c = DATA.compras || [];
      const rows = c.slice(0,120).map(r=>`
        <tr>
          <td>${r.id||''}</td>
          <td>${r.fecha||''}</td>
          <td>${r.proveedor||''}</td>
          <td>${money(r.total||0)}</td>
          <td>${badge(r.estadopago)}</td>
          <td>${badge(r.estadocompra)}</td>
        </tr>
      `).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--muted);padding:.8rem;">Sin compras registradas.</td></tr>';

      return `
        <div class="page-header">
          <div>
            <h1>Compras</h1>
            <p>Compras de insumos y otros conceptos</p>
          </div>
        </div>
        <div class="card">
          <h3>Listado de compras</h3>
          <div style="max-height:460px;overflow:auto;margin-top:.4rem;border-radius:.7rem;border:1px solid #020617;">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Fecha</th>
                  <th>Proveedor</th>
                  <th>Total</th>
                  <th>Estado Pago</th>
                  <th>Estado Compra</th>
                </tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
          </div>
        </div>
      `;
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ PROVEEDORES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderProveedores(){
      const p = DATA.proveedores || [];
      const rows = p.slice(0,120).map(r=>`
        <tr>
          <td>${r.id||''}</td>
          <td>${r.nombre||''}</td>
          <td>${r.ruc||''}</td>
          <td>${r.telefono||''}</td>
          <td>${r.email||''}</td>
          <td>${r.categoria||''}</td>
          <td>${r.calificacion||''}</td>
          <td>${r.estado||''}</td>
        </tr>
      `).join('') || '<tr><td colspan="8" style="text-align:center;color:var(--muted);padding:.8rem;">Sin proveedores.</td></tr>';

      return `
        <div class="page-header">
          <div>
            <h1>Proveedores</h1>
            <p>Makro, Guta y otros aliados</p>
          </div>
        </div>
        <div class="card">
          <h3>Directorio de proveedores</h3>
          <div style="max-height:460px;overflow:auto;margin-top:.4rem;border-radius:.7rem;border:1px solid #020617;">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nombre</th>
                  <th>RUC</th>
                  <th>Tel√©fono</th>
                  <th>Email</th>
                  <th>Categor√≠a</th>
                  <th>Calificaci√≥n</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
          </div>
        </div>
      `;
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ GASTOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderGastos(){
      const g = DATA.gastos || [];
      const rows = g.slice(0,160).map(r=>`
        <tr>
          <td>${r.id||''}</td>
          <td>${r.fecha||''}</td>
          <td>${r.categoria||''}</td>
          <td>${r.descripcion||''}</td>
          <td>${money(r.monto||0)}</td>
          <td>${r.metodopago||''}</td>
          <td>${r.cuenta||''}</td>
          <td>${badge(r.estado)}</td>
        </tr>
      `).join('') || '<tr><td colspan="8" style="text-align:center;color:var(--muted);padding:.8rem;">Sin gastos registrados.</td></tr>';

      return `
        <div class="page-header">
          <div>
            <h1>Gastos</h1>
            <p>Servicios, compras, personal, publicidad, delivery y m√°s</p>
          </div>
        </div>
        <div class="stats-grid">
          <div class="card">
            <h3>Lista de gastos</h3>
            <div style="max-height:430px;overflow:auto;margin-top:.4rem;border-radius:.7rem;border:1px solid #020617;">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Fecha</th>
                    <th>Categor√≠a</th>
                    <th>Descripci√≥n</th>
                    <th>Monto</th>
                    <th>M√©todo</th>
                    <th>Cuenta</th>
                    <th>Estado</th>
                  </tr>
                </thead>
                <tbody>${rows}</tbody>
              </table>
            </div>
          </div>
          <div class="card">
            <h3>Gastos por categor√≠a</h3>
            <small>Vista r√°pida de distribuci√≥n de gastos</small>
            <canvas id="chartGastos" style="max-height:260px;margin-top:.7rem;"></canvas>
          </div>
        </div>
      `;
    }

    function initGastosChart(){
      const canvas = document.getElementById('chartGastos');
      if(!canvas) return;
      const g = DATA.gastos || [];
      const map = {};
      g.forEach(r=>{
        const cat = r.categoria || 'Otro';
        const monto = parseFloat(r.monto || 0);
        if(!map[cat]) map[cat]=0;
        map[cat]+=monto;
      });
      const labels = Object.keys(map);
      const data = Object.values(map);
      if(!labels.length) return;
      if(gastosChart){gastosChart.destroy();}
      gastosChart = new Chart(canvas,{
        type:'doughnut',
        data:{labels,datasets:[{data}]},
        options:{
          plugins:{
            legend:{labels:{color:'#e2e8f0',font:{size:11}}}
          }
        }
      });
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SERVICIOS (wrapper sobre GASTOS) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderServicios(){
      const g = DATA.gastos || [];
      const servicios = g.filter(x => String(x.categoria||'').toLowerCase()==='servicios');
      const rows = servicios.slice(0,160).map(r=>`
        <tr>
          <td>${r.id||''}</td>
          <td>${r.fecha||''}</td>
          <td>${r.descripcion||''}</td>
          <td>${money(r.monto||0)}</td>
          <td>${r.metodopago||''}</td>
          <td>${r.cuenta||''}</td>
          <td>${badge(r.estado)}</td>
        </tr>
      `).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--muted);padding:.8rem;">Sin servicios registrados (categor√≠a "Servicios" en Gastos).</td></tr>';

      return `
        <div class="page-header">
          <div>
            <h1>Servicios</h1>
            <p>Luz, agua, internet, alquiler, etc. (desde m√≥dulo Gastos)</p>
          </div>
        </div>

        <div class="card">
          <h3>Registrar servicio r√°pido</h3>
          <small>Se guarda como Gasto con categor√≠a "Servicios"</small>
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:.55rem;margin-top:.6rem;">
            <input id="svcDesc" type="text" placeholder="Servicio (ej: Luz Enel Enero)" style="padding:.45rem;border-radius:.6rem;border:1px solid var(--border);background:#020617;color:#e2e8f0;">
            <input id="svcMonto" type="number" step="0.01" placeholder="Monto (S/)" style="padding:.45rem;border-radius:.6rem;border:1px solid var(--border);background:#020617;color:#e2e8f0;">
            <select id="svcMedio" style="padding:.45rem;border-radius:.6rem;border:1px solid var(--border);background:#020617;color:#e2e8f0;">
              <option value="">Medio de pago</option>
              <option>Transferencia</option>
              <option>Tarjeta</option>
              <option>Efectivo</option>
              <option>Yape / Plin</option>
            </select>
            <select id="svcCuenta" style="padding:.45rem;border-radius:.6rem;border:1px solid var(--border);background:#020617;color:#e2e8f0;">
              <option value="">Cuenta</option>
              <option>Bcp BRAVIZIMO‚ÄôS</option>
              <option>RUS Rosa</option>
              <option>RUS Mart√≠n</option>
              <option>RUS Milagros</option>
              <option>RUS Sandy</option>
            </select>
          </div>
          <button class="btn btn-primary" style="margin-top:.7rem;" onclick="guardarServicioComoGasto()">
            <i class="fas fa-save"></i> Guardar servicio
          </button>
        </div>

        <div class="card" style="margin-top:.75rem;">
          <h3>Historial de servicios (gastos)</h3>
          <div style="max-height:380px;overflow:auto;margin-top:.4rem;border-radius:.7rem;border:1px solid #020617;">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Fecha</th>
                  <th>Servicio</th>
                  <th>Monto</th>
                  <th>Medio</th>
                  <th>Cuenta</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
          </div>
        </div>
      `;
    }

    async function guardarServicioComoGasto(){
      const desc   = document.getElementById('svcDesc').value.trim();
      const monto  = parseFloat(document.getElementById('svcMonto').value || '0');
      const medio  = document.getElementById('svcMedio').value;
      const cuenta = document.getElementById('svcCuenta').value;

      if(!desc || !monto){
        showToast('Coloca descripci√≥n y monto.', 'warn');
        return;
      }

      try{
        const res = await fetch(API_URL,{
          method:'POST',
          headers:{'Content-Type':'application/json;charset=utf-8'},
          body:JSON.stringify({
            action:'crear_gasto',
            categoria:'Servicios',
            descripcion:desc,
            monto:monto,
            metodopago:medio,
            cuenta:cuenta,
            estado:'Pagado'
          })
        });
        const jsonResp = await res.json();
        if(jsonResp.error){
          showToast('Error al guardar servicio: '+jsonResp.mensaje,'error');
        }else{
          showToast('Servicio guardado en Gastos.', 'success');
          await syncData();
          navigateTo('servicios', document.querySelector('.nav-item[data-page="servicios"]'));
        }
      }catch(e){
        console.error(e);
        showToast('Error de conexi√≥n al guardar servicio.', 'error');
      }
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ FACTURAS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderFacturas(){
      const f = DATA.facturas || [];
      const rows = f.slice(0,120).map(r=>`
        <tr>
          <td>${r.id||''}</td>
          <td>${r.tipo||''}</td>
          <td>${r.numero||''}</td>
          <td>${r.fecha||''}</td>
          <td>${r.cliente||''}</td>
          <td>${money(r.total||0)}</td>
          <td>${badge(r.estado)}</td>
        </tr>
      `).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--muted);padding:.8rem;">Sin facturas registradas.</td></tr>';

      return `
        <div class="page-header">
          <div>
            <h1>Facturas y boletas</h1>
            <p>Comprobantes emitidos para SUNAT</p>
          </div>
        </div>
        <div class="card">
          <h3>Comprobantes</h3>
          <div style="max-height:460px;overflow:auto;margin-top:.4rem;border-radius:.7rem;border:1px solid #020617;">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Tipo</th>
                  <th>N√∫mero</th>
                  <th>Fecha</th>
                  <th>Cliente</th>
                  <th>Total</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
          </div>
        </div>
      `;
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ DELIVERY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderDelivery(){
      const d = DATA.delivery || [];
      const rows = d.slice(0,120).map(r=>`
        <tr>
          <td>${r.id||''}</td>
          <td>${r.fecha||''}</td>
          <td>${r.cliente||''}</td>
          <td>${r.direccion||''}</td>
          <td>${r.distrito||''}</td>
          <td>${r.repartidor||''}</td>
          <td>${money(r.costo||0)}</td>
          <td>${badge(r.estado)}</td>
        </tr>
      `).join('') || '<tr><td colspan="8" style="text-align:center;color:var(--muted);padding:.8rem;">Sin entregas registradas.</td></tr>';

      return `
        <div class="page-header">
          <div>
            <h1>Delivery</h1>
            <p>Entregas por distrito, repartidor y estado</p>
          </div>
        </div>
        <div class="card">
          <h3>Pedidos de delivery</h3>
          <div style="max-height:460px;overflow:auto;margin-top:.4rem;border-radius:.7rem;border:1px solid #020617;">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Fecha</th>
                  <th>Cliente</th>
                  <th>Direcci√≥n</th>
                  <th>Distrito</th>
                  <th>Repartidor</th>
                  <th>Costo</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
          </div>
        </div>
      `;
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ CLIENTES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderClientes(){
      const c = DATA.clientes || [];
      const rows = c.slice(0,120).map(r=>`
        <tr>
          <td>${r.id||''}</td>
          <td>${r.nombre||''}</td>
          <td>${r.documento||''}</td>
          <td>${r.telefono||''}</td>
          <td>${r.email||''}</td>
          <td>${r.segmento||''}</td>
          <td>${money(r.totalcompras||0)}</td>
          <td>${r.estado||''}</td>
        </tr>
      `).join('') || '<tr><td colspan="8" style="text-align:center;color:var(--muted);padding:.8rem;">Sin clientes registrados.</td></tr>';

      return `
        <div class="page-header">
          <div>
            <h1>Clientes</h1>
            <p>Ranking b√°sico por monto y segmento</p>
          </div>
        </div>
        <div class="card">
          <h3>Lista de clientes</h3>
          <div style="max-height:460px;overflow:auto;margin-top:.4rem;border-radius:.7rem;border:1px solid #020617;">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nombre</th>
                  <th>Documento</th>
                  <th>Tel√©fono</th>
                  <th>Email</th>
                  <th>Segmento</th>
                  <th>Total Compras</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
          </div>
        </div>
      `;
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ PERSONAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderPersonal(){
      const p = DATA.personal || [];
      const rows = p.slice(0,120).map(r=>`
        <tr>
          <td>${r.id||''}</td>
          <td>${r.nombre||''}</td>
          <td>${r.dni||''}</td>
          <td>${r.cargo||''}</td>
          <td>${r.telefono||''}</td>
          <td>${money(r.sueldo||0)}</td>
          <td>${r.comision||r.comisionporcentaje||''}</td>
          <td>${r.estado||''}</td>
        </tr>
      `).join('') || '<tr><td colspan="8" style="text-align:center;color:var(--muted);padding:.8rem;">Sin personal registrado.</td></tr>';

      return `
        <div class="page-header">
          <div>
            <h1>Personal</h1>
            <p>Equipo, sueldos base y comisiones</p>
          </div>
        </div>
        <div class="card">
          <h3>Colaboradores</h3>
          <div style="max-height:460px;overflow:auto;margin-top:.4rem;border-radius:.7rem;border:1px solid #020617;">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nombre</th>
                  <th>DNI</th>
                  <th>Cargo</th>
                  <th>Tel√©fono</th>
                  <th>Sueldo</th>
                  <th>Comisi√≥n %</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
          </div>
        </div>
      `;
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ RECLAMOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderReclamos(){
      const r = DATA.reclamos || [];
      const rows = r.slice(0,120).map(x=>`
        <tr>
          <td>${x.id||''}</td>
          <td>${x.fecha||''}</td>
          <td>${x.cliente||''}</td>
          <td>${x.tipo||''}</td>
          <td>${x.descripcion||''}</td>
          <td>${x.prioridad||''}</td>
          <td>${badge(x.estado)}</td>
        </tr>
      `).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--muted);padding:.8rem;">Sin reclamos registrados.</td></tr>';

      return `
        <div class="page-header">
          <div>
            <h1>Reclamos</h1>
            <p>Seguimiento de problemas en pedidos</p>
          </div>
        </div>
        <div class="card">
          <h3>Historial de reclamos</h3>
          <div style="max-height:460px;overflow:auto;margin-top:.4rem;border-radius:.7rem;border:1px solid #020617;">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Fecha</th>
                  <th>Cliente</th>
                  <th>Tipo</th>
                  <th>Descripci√≥n</th>
                  <th>Prioridad</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
          </div>
        </div>
      `;
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ KPI VENDEDORAS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderKpiVendedoras(){
      const k = DATA.kpiVendedoras || [];
      const rows = k.slice(0,80).map(r=>`
        <tr>
          <td>${r.fecha||''}</td>
          <td>${r.vendedora||''}</td>
          <td>${money(r.ventas||0)}</td>
          <td>${r.pedidos||''}</td>
          <td>${money(r.ticketprom||0)}</td>
          <td>${money(r.meta||0)}</td>
          <td>${r.cumplimientoporcentaje||r.cumplimiento||''}</td>
          <td>${r.ranking||''}</td>
        </tr>
      `).join('') || '<tr><td colspan="8" style="text-align:center;color:var(--muted);padding:.8rem;">Sin KPI registrados.</td></tr>';

      return `
        <div class="page-header">
          <div>
            <h1>KPI vendedoras</h1>
            <p>Ventas, pedidos, ticket promedio y cumplimiento</p>
          </div>
        </div>
        <div class="stats-grid">
          <div class="card">
            <h3>Ranking</h3>
            <div style="max-height:260px;overflow:auto;margin-top:.4rem;border-radius:.7rem;border:1px solid #020617;">
              <table>
                <thead>
                  <tr>
                    <th>Fecha</th>
                    <th>Vendedora</th>
                    <th>Ventas</th>
                    <th>Pedidos</th>
                    <th>Ticket Prom</th>
                    <th>Meta</th>
                    <th>%</th>
                    <th>Rank</th>
                  </tr>
                </thead>
                <tbody>${rows}</tbody>
              </table>
            </div>
          </div>
          <div class="card">
            <h3>Ventas por vendedora</h3>
            <canvas id="chartKpi" style="max-height:260px;margin-top:.7rem;"></canvas>
          </div>
        </div>
      `;
    }

    function initKpiChart(){
      const canvas = document.getElementById('chartKpi');
      if(!canvas) return;
      const k = DATA.kpiVendedoras || [];
      const map = {};
      k.forEach(r=>{
        const v = r.vendedora || 'Otro';
        const m = parseFloat(r.ventas||0);
        if(!map[v]) map[v]=0;
        map[v]+=m;
      });
      const labels = Object.keys(map);
      const data = Object.values(map);
      if(!labels.length) return;
      if(kpiChart){kpiChart.destroy();}
      kpiChart = new Chart(canvas,{
        type:'bar',
        data:{labels,datasets:[{data}]},
        options:{
          plugins:{legend:{display:false}},
          scales:{
            x:{ticks:{color:'#e2e8f0'}},
            y:{ticks:{color:'#e2e8f0'}}
          }
        }
      });
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ KSD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderKsd(){
      const k = DATA.ksd || [];
      const rows = k.slice(0,80).map(r=>`
        <tr>
          <td>${r.fecha||''}</td>
          <td>${money(r.ventasnetas||0)}</td>
          <td>${r.margenbruto||r.margenbrutoporcentaje||''}</td>
          <td>${r.numpedidos||''}</td>
          <td>${money(r.ticketpromedio||0)}</td>
          <td>${r.satisfaccion||''}</td>
        </tr>
      `).join('') || '<tr><td colspan="6" style="text-align:center;color:var(--muted);padding:.8rem;">Sin KSD registrados.</td></tr>';
      return `
        <div class="page-header">
          <div>
            <h1>KSD diario</h1>
            <p>Ventas netas, margen y satisfacci√≥n por d√≠a</p>
          </div>
        </div>
        <div class="card">
          <h3>Hist√≥rico KSD</h3>
          <div style="max-height:460px;overflow:auto;margin-top:.4rem;border-radius:.7rem;border:1px solid #020617;">
            <table>
              <thead>
                <tr>
                  <th>Fecha</th>
                  <th>Ventas Netas</th>
                  <th>Margen Bruto %</th>
                  <th>Pedidos</th>
                  <th>Ticket Promedio</th>
                  <th>Satisfacci√≥n</th>
                </tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
          </div>
        </div>
      `;
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
