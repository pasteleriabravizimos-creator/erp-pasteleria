<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BRAVIZIMO'S | Dashboard Insumos por Fecha</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#fafafa; }
    header { padding: 14px 18px; background:#111; color:#fff; }
    main { padding: 16px; max-width: 1200px; margin: 0 auto; }
    .row { display:flex; gap:12px; flex-wrap:wrap; align-items:end; }
    .cardGrid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:12px; margin-top: 14px;}
    .card { background:#fff; border:1px solid #e6e6e6; border-radius:10px; padding:12px; }
    .kpiTitle { font-size:12px; color:#666; }
    .kpiValue { font-size:22px; font-weight:700; margin-top:6px; }
    label { display:block; font-size:12px; color:#444; margin-bottom:4px; }
    input, select, button { padding: 10px; font-size: 14px; border-radius:8px; border:1px solid #ddd; background:#fff; }
    button { cursor:pointer; background:#111; color:#fff; border:1px solid #111; }
    button.secondary { background:#fff; color:#111; }
    h3 { margin: 18px 0 8px; }
    table { border-collapse: collapse; width:100%; background:#fff; border:1px solid #e6e6e6; border-radius:10px; overflow:hidden; }
    th, td { padding:8px; border-bottom:1px solid #eee; text-align:left; font-size:13px; }
    th { background:#f5f5f5; }
    .twoCol { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    @media (max-width: 900px){ .twoCol { grid-template-columns: 1fr; } }
    .muted { color:#666; font-size:12px; }
    .warn { color:#b45309; font-size:12px; }
    .err { color:#b91c1c; font-size:12px; }
  </style>
</head>
<body>
  <header>
    <div style="font-weight:700;">BRAVIZIMO'S — Dashboard Insumos por Fecha</div>
    <div class="muted" style="color:#cfcfcf;">Ventas/Producción → Packs → Recetas → Insumos → Costos → Margen</div>
  </header>

  <main>
    <div class="row">
      <div>
        <label>Fecha</label>
        <input type="date" id="fecha" />
      </div>

      <div>
        <label>Hoja producción/ventas</label>
        <input id="prodSheet" placeholder="ej: enero 2026" value="enero 2026" />
        <div class="muted">Debe ser el nombre exacto de la pestaña donde está tu reporte diario.</div>
      </div>

      <div style="min-width:320px; flex:1;">
        <label>URL Web App (Apps Script)</label>
        <input id="apiUrl" placeholder="Pega aquí tu URL de Apps Script (Web App)" />
        <div class="muted">La URL termina en /exec</div>
      </div>

      <button id="btnCargar">Calcular</button>
      <button id="btnExportar" class="secondary">Exportar CSV Insumos</button>
    </div>

    <div id="msg" class="muted" style="margin-top:10px;"></div>

    <div class="cardGrid">
      <div class="card">
        <div class="kpiTitle">Venta total (S/)</div>
        <div class="kpiValue" id="kpiVenta">—</div>
      </div>
      <div class="card">
        <div class="kpiTitle">Costo total insumos (S/)</div>
        <div class="kpiValue" id="kpiCosto">—</div>
      </div>
      <div class="card">
        <div class="kpiTitle">Utilidad estimada (S/)</div>
        <div class="kpiValue" id="kpiUtilidad">—</div>
      </div>
      <div class="card">
        <div class="kpiTitle">Margen (%)</div>
        <div class="kpiValue" id="kpiMargen">—</div>
      </div>
      <div class="card">
        <div class="kpiTitle">Unidades totales</div>
        <div class="kpiValue" id="kpiUnidades">—</div>
      </div>
      <div class="card">
        <div class="kpiTitle">Insumos distintos</div>
        <div class="kpiValue" id="kpiInsumos">—</div>
      </div>
    </div>

    <div class="twoCol" style="margin-top:12px;">
      <div class="card">
        <div style="font-weight:700; margin-bottom:8px;">Top productos por cantidad</div>
        <canvas id="chTopProductos"></canvas>
      </div>
      <div class="card">
        <div style="font-weight:700; margin-bottom:8px;">Costo por insumo (Top)</div>
        <canvas id="chCostoInsumo"></canvas>
      </div>
    </div>

    <h3>Productos consolidados (incluye packs desarmados)</h3>
    <div class="muted">Si un producto no tiene receta, aparecerá en “observaciones”.</div>
    <table>
      <thead>
        <tr>
          <th>Producto</th>
          <th>Cantidad</th>
          <th>Precio venta</th>
          <th>Venta estimada</th>
          <th>Costo estimado</th>
          <th>Utilidad</th>
        </tr>
      </thead>
      <tbody id="tbProductos"></tbody>
    </table>

    <h3>Insumos requeridos</h3>
    <table>
      <thead>
        <tr>
          <th>Insumo</th>
          <th>Cantidad requerida</th>
          <th>Unidad</th>
          <th>Costo unitario</th>
          <th>Costo total</th>
        </tr>
      </thead>
      <tbody id="tbInsumos"></tbody>
    </table>

    <h3>Observaciones</h3>
    <div id="obs" class="warn">—</div>
  </main>

  <script src="./script.js"></script>
</body>
</html>
