<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>BRAVIZIMO’S ERP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    body{margin:0;font-family:system-ui, -apple-system, BlinkMacSystemFont, sans-serif;background:#020617;color:#e2e8f0;display:flex;min-height:100vh}
    .sidebar{width:250px;border-right:1px solid #1e293b;padding:1rem;display:flex;flex-direction:column;gap:.5rem}
    .main{flex:1;padding:1rem 1.5rem}
    .nav-item{padding:.35rem .55rem;border-radius:.5rem;font-size:.85rem;cursor:pointer;color:#94a3b8}
    .nav-item:hover{background:#020617;color:#e2e8f0}
    .nav-item.active{background:rgba(79,70,229,.2);color:#e2e8f0;border:1px solid rgba(79,70,229,.6)}
    .card{border-radius:.8rem;border:1px solid #1e293b;padding:.9rem 1rem;margin-bottom:.75rem;background:#020617}
    table{width:100%;border-collapse:collapse;font-size:.8rem}
    th,td{padding:.4rem .5rem;border-bottom:1px solid #020617;text-align:left}
    th{font-size:.7rem;letter-spacing:.06em;text-transform:uppercase;color:#64748b;background:#020617}
    .badge{display:inline-flex;padding:.1rem .45rem;border-radius:999px;font-size:.65rem;border:1px solid #4b5563}
    .badge.green{border-color:rgba(22,163,74,.6);color:#4ade80;background:rgba(22,163,74,.15)}
    .badge.red{border-color:rgba(248,113,113,.7);color:#fecaca;background:rgba(248,113,113,.12)}
    .loader{text-align:center;padding:2rem 0;color:#64748b;font-size:.85rem}
  </style>
</head>
<body>
  <aside class="sidebar">
    <div style="font-weight:700;font-size:.95rem;margin-bottom:.5rem;">BRAVIZIMO’S ERP</div>
    <div class="nav-item active" data-page="dashboard" onclick="go('dashboard',this)">Dashboard</div>
    <div class="nav-item" data-page="ventas" onclick="go('ventas',this)">Ventas</div>
    <div class="nav-item" data-page="inventario" onclick="go('inventario',this)">Inventario</div>
    <div class="nav-item" data-page="recetas" onclick="go('recetas',this)">Recetario</div>
    <div class="nav-item" data-page="produccion" onclick="go('produccion',this)">Producción</div>
    <div class="nav-item" data-page="compras" onclick="go('compras',this)">Compras</div>
    <div class="nav-item" data-page="gastos" onclick="go('gastos',this)">Gastos</div>
    <div class="nav-item" data-page="servicios" onclick="go('servicios',this)">Servicios</div>
    <div class="nav-item" data-page="facturas" onclick="go('facturas',this)">Facturas</div>
    <div class="nav-item" data-page="delivery" onclick="go('delivery',this)">Delivery</div>
    <div class="nav-item" data-page="clientes" onclick="go('clientes',this)">Clientes</div>
    <div class="nav-item" data-page="personal" onclick="go('personal',this)">RRHH / Personal</div>
    <div class="nav-item" data-page="reclamos" onclick="go('reclamos',this)">Reclamos</div>
  </aside>
  <main class="main">
    <div id="app"></div>
  </main>

<script>
  // ⚠️ Cambia esto por la URL del Web App del Apps Script
  const API_URL = 'TU_WEB_APP_URL_AQUI';

  let DATA = null;
  let DASH = null;
  let page = 'dashboard';

  async function init() {
    try {
      showLoader('Cargando ERP...');
      const [d, all] = await Promise.all([
        fetch(API_URL + '?action=dashboard').then(r => r.json()),
        fetch(API_URL + '?action=getAll').then(r => r.json())
      ]);
      DASH = d;
      DATA = all;
      render();
    } catch (e) {
      console.error(e);
      showLoader('Error al conectar con el ERP. Revisa la URL del Web App.');
    }
  }

  function showLoader(msg) {
    document.getElementById('app').innerHTML = '<div class="loader">'+msg+'</div>';
  }

  function go(p, el) {
    page = p;
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    if (el) el.classList.add('active');
    render();
  }

  function render() {
    if (!DATA || !DASH) { showLoader('Cargando datos...'); return; }
    const app = document.getElementById('app');
    if (page === 'dashboard') return app.innerHTML = renderDashboard();
    if (page === 'ventas')    return app.innerHTML = renderVentas();
    if (page === 'inventario')return app.innerHTML = renderInventario();
    if (page === 'recetas')   return app.innerHTML = renderRecetas();
    if (page === 'produccion')return app.innerHTML = renderProduccion();
    if (page === 'compras')   return app.innerHTML = renderCompras();
    if (page === 'gastos')    return app.innerHTML = renderGastos();
    if (page === 'servicios') return app.innerHTML = renderServicios();
    if (page === 'facturas')  return app.innerHTML = renderFacturas();
    if (page === 'delivery')  return app.innerHTML = renderDelivery();
    if (page === 'clientes')  return app.innerHTML = renderClientes();
    if (page === 'personal')  return app.innerHTML = renderPersonal();
    if (page === 'reclamos')  return app.innerHTML = renderReclamos();
  }

  function money(v){v=parseFloat(v||0);return 'S/ '+v.toFixed(2);}

  // ---- Dashboard simple ----
  function renderDashboard() {
    return `
      <div class="card">
        <h3>Resumen general</h3>
        <p style="font-size:.8rem;color:#64748b;">Ventas, pedidos y alertas de inventario/servicios</p>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:.75rem;margin-top:.75rem;">
          <div>
            <div style="font-size:.75rem;color:#64748b;">Ventas hoy</div>
            <div style="font-size:1.3rem;font-weight:600;">${money(DASH.ventasHoy.total)}</div>
            <div style="font-size:.75rem;color:#64748b;">${DASH.ventasHoy.cantidad||0} pedidos</div>
          </div>
          <div>
            <div style="font-size:.75rem;color:#64748b;">Ventas mes</div>
            <div style="font-size:1.3rem;font-weight:600;">${money(DASH.ventasMes.total)}</div>
            <div style="font-size:.75rem;color:#64748b;">${DASH.ventasMes.cantidad||0} pedidos</div>
          </div>
          <div>
            <div style="font-size:.75rem;color:#64748b;">Ticket promedio</div>
            <div style="font-size:1.3rem;font-weight:600;">${money(DATA.estadisticas.ticketPromedio||0)}</div>
            <div style="font-size:.75rem;color:#64748b;">${DATA.estadisticas.cantidadVentas||0} ventas históricas</div>
          </div>
        </div>
      </div>
      <div class="card">
        <h3>Alertas rápidas</h3>
        <ul style="margin:.4rem 0 0;padding-left:1.1rem;font-size:.78rem;color:#e2e8f0;max-height:220px;overflow:auto;">
          ${(DASH.alertas||[]).map(a => '<li>'+a.mensaje+'</li>').join('') || '<li style="color:#64748b;">Sin alertas por ahora.</li>'}
        </ul>
      </div>
    `;
  }

  // ---- Módulos ejemplo (ventas / inventario / servicios…) ----
  function renderVentas() {
    const v = DATA.ventas || [];
    const filas = v.slice(0,80).map(r => `
      <tr>
        <td>${r.idventa||''}</td>
        <td>${r.fecharegistro||''}</td>
        <td>${r.cliente||''}</td>
        <td>${r.canal||''}</td>
        <td>${money(r.total||0)}</td>
        <td><span class="badge ${String(r.estadopago||'').toLowerCase()==='pagado'?'green':'red'}">${r.estadopago||''}</span></td>
      </tr>
    `).join('') || '<tr><td colspan="6" style="text-align:center;color:#64748b;padding:.6rem;">Sin ventas.</td></tr>';

    return `
      <div class="card">
        <h3>Ventas</h3>
        <div style="max-height:430px;overflow:auto;margin-top:.5rem;">
          <table>
            <thead>
              <tr><th>ID</th><th>Fecha</th><th>Cliente</th><th>Canal</th><th>Total</th><th>Pago</th></tr>
            </thead>
            <tbody>${filas}</tbody>
          </table>
        </div>
      </div>
    `;
  }

  function renderInventario() {
    const inv = DATA.inventario || [];
    const filas = inv.slice(0,120).map(p => `
      <tr>
        <td>${p.codigo||''}</td>
        <td>${p.nombreproducto||''}</td>
        <td>${p.categoria||''}</td>
        <td>${p.stockactual||''}</td>
        <td>${p.stockminimo||''}</td>
        <td>${money(p.precioventa||0)}</td>
      </tr>
    `).join('') || '<tr><td colspan="6" style="text-align:center;color:#64748b;padding:.6rem;">Sin productos.</td></tr>';
    return `
      <div class="card">
        <h3>Inventario productos</h3>
        <div style="max-height:430px;overflow:auto;margin-top:.5rem;">
          <table>
            <thead>
              <tr><th>Código</th><th>Producto</th><th>Categoría</th><th>Stock</th><th>Mínimo</th><th>Precio</th></tr>
            </thead>
            <tbody>${filas}</tbody>
          </table>
        </div>
      </div>
    `;
  }

  function renderRecetas() {
    const maestro = DATA.recetasMaestro || [];
    const filas = maestro.slice(0,80).map(r => `
      <tr>
        <td>${r.codigo||''}</td><td>${r.producto||''}</td><td>${r.rendimiento||''}</td><td>${r.tiempomin||''}</td>
      </tr>`).join('') || '<tr><td colspan="4" style="text-align:center;color:#64748b;padding:.6rem;">Sin recetas.</td></tr>';
    return `
      <div class="card">
        <h3>Recetas maestras</h3>
        <div style="max-height:430px;overflow:auto;margin-top:.5rem;">
          <table>
            <thead><tr><th>Código</th><th>Producto</th><th>Rendimiento</th><th>Tiempo (min)</th></tr></thead>
            <tbody>${filas}</tbody>
          </table>
        </div>
      </div>
    `;
  }

  // El resto de módulos: mismos patrones
  function renderProduccion(){return '<div class="card"><h3>Producción</h3><p style="font-size:.8rem;color:#64748b;">Aquí listarás órdenes de producción.</p></div>';}
  function renderCompras(){return '<div class="card"><h3>Compras</h3><p style="font-size:.8rem;color:#64748b;">Lista de compras a proveedores.</p></div>';}
  function renderGastos(){return '<div class="card"><h3>Gastos</h3><p style="font-size:.8rem;color:#64748b;">Gastos por categoría / cuenta.</p></div>';}
  function renderServicios(){return '<div class="card"><h3>Servicios</h3><p style="font-size:.8rem;color:#64748b;">Servicios por pagar y pagados.</p></div>'; }
  function renderFacturas(){return '<div class="card"><h3>Facturas</h3><p style="font-size:.8rem;color:#64748b;">Facturas y boletas emitidas.</p></div>'; }
  function renderDelivery(){return '<div class="card"><h3>Delivery</h3><p style="font-size:.8rem;color:#64748b;">Entregas por distrito y repartidor.</p></div>'; }
  function renderClientes(){return '<div class="card"><h3>Clientes</h3><p style="font-size:.8rem;color:#64748b;">Ranking de clientes y datos.</p></div>'; }
  function renderPersonal(){return '<div class="card"><h3>RRHH / Personal</h3><p style="font-size:.8rem;color:#64748b;">Colaboradores, sueldos y asistencia.</p></div>'; }
  function renderReclamos(){return '<div class="card"><h3>Reclamos</h3><p style="font-size:.8rem;color:#64748b;">Historial de reclamos por pedido.</p></div>'; }

  init();
</script>
</body>
</html>
